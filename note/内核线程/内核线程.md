## 1. 中断向量注册过程 + 异常、外部、陷阱门触发过程

![内核线程.drawio](\\wsl.localhost\Ubuntu-20.04\home\zhang\onix\note\内核线程\内核线程.drawio.svg)

## 2. 内核线程调度流程



## 3. 操作系统基础任务

### 3.1 空闲进程 idle

用于所有进程都阻塞的情况下，调度执行，一般进程id为0



只要工作用于：

1. 开中断

2. 关闭CPU，等待外中断

3. yield调度执行其他程序



### 3.2 初始化进程 init

用于执行初始化操作，进入用户态等工作，进程id为1

### 4 进程上下文切换代码解释
``` asm
这段汇编代码是一个简单的任务切换函数，通常用于多任务操作系统或实时操作系统中。下面是对每一行代码的解释：

global task_switch;声明task_switch为全局函数，这样其他汇编文件或C/C++代码也可以调用它。
task_switch:;函数开始。
push ebp;将当前函数的基指针（EBP）压入栈中，以便在返回时恢复。
mov ebp, esp;将当前的栈指针（ESP）复制到基指针（EBP）。
push ebx、push esi、push edi;分别将EBX、ESI、EDI三个寄存器的值压入栈中，以保存它们的值，因为在函数内部可能会修改它们。
mov eax, esp ;将栈指针（ESP）的值复制到EAX寄存器。
and eax, 0xfffff000;对EAX寄存器的值进行位与操作，确保它是一个16MB的页面对齐地址。这是为了满足某些硬件和操作系统的要求。
mov [eax], esp ;esp保存将当前的栈指针（ESP）的值存储到EAX指向的地址，这是一个对栈内存的写入操作，通常用于保存当前的栈顶指针。
mov eax, [ebp + 8] ;next从当前函数的参数区域（偏移量为8的地址）读取一个值到EAX寄存器。这通常是一个指向下一个任务的指针。
mov esp, [eax] ;取出esp，栈顶指针将EAX指向的地址（即下一个任务的栈顶指针）的值复制到栈指针（ESP）。
pop edi、pop esi、pop ebx;分别从栈中弹出之前保存的EDI、ESI、EBX的值，恢复它们的原始值。
pop ebp;从栈中弹出基指针（EBP）的值，恢复它。
ret;返回调用者。
;总的来说，这个函数用于实现任务切换的功能。当一个任务需要被另一个任务替换时，当前任务的栈顶指针会被保存，然后加载下一个任务的栈顶指针，从而完成任务的切换。
```


